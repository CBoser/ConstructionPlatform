Useful API Integration Patterns Found
1. From the Kendo/Builder Portal Code (Documents 1-5)
Data structures you'd need to expose:
javascript// From builderportal.common.js - These are the actual API endpoints
var urls = {
    userPrivileges: "~/BuilderPortal/Dashboard/GetPrivileges",
    userWMSSettings: "~/BuilderPortal/Dashboard/GetWMSSettings",
    supplierDetails: "~/BuilderPortal/Supplier/GetSupplierDetails",
    getPOList: "~/BuilderPortal/PurchaseOrders/GetPOList",
    getPOListByPOHeaderIds: "~/BuilderPortal/PurchaseOrders/GetPOListByPOHeaderIds"
};

// Purchase Order structure (implied from viewPO function)
{
    PoNumber: string,
    PoHeaderID: string,
    StatusCode: string,
    FileName: string
}

// Status codes you saw in CSS
{
    notconfirmed: "red",      // Action needed
    pending: "yellow",         // In progress  
    confirmed: "green",        // Complete
    late: "#F9AAAC"           // Past due
}
API Pattern They Use:
javascript$.ajax({
    url: url,
    type: "GET",
    data: { scheduleActivityId: activityId },
    success: function(result) {
        // Returns array of PO objects
        result.forEach(po => {
            // po.PoNumber, po.PoHeaderID, po.StatusCode, po.FileName
        });
    }
});

2. From Scheduling Code (Document 5)
Critical date/time handling:
javascript// They use timezone offset manipulation
addOffset: function(data) {
    var offsetMs = getStandardTimeZoneOffSet() * 60000;
    data.forEach(item => {
        item.BaseStartDate = addOffset(item.BaseStartDate, offsetMs);
        item.BaseEndDate = addOffset(item.BaseEndDate, offsetMs);
        item.ProjStartDate = addOffset(item.ProjStartDate, offsetMs);
        item.SchStartDate = addOffset(item.SchStartDate, offsetMs);
        item.ActualStartDate = addOffset(item.ActualStartDate, offsetMs);
    });
}

// Date fields you need in your API
{
    BaseStartDate: ISO8601,
    BaseEndDate: ISO8601,
    ProjStartDate: ISO8601,
    ProjEndDate: ISO8601,
    SchStartDate: ISO8601,
    SchEndDate: ISO8601,
    ActualStartDate: ISO8601,
    ActualEndDate: ISO8601,
    ScheduleLastViewed: ISO8601
}
‚ö†Ô∏è Critical for your API: Always use ISO 8601 format with timezone: 2025-11-14T10:00:00-08:00

3. From Grid/Search Code (Documents 2-3)
Filter/Search API patterns:
javascript// They use field-level filtering
applyFilter: function(gridId, filterField, filterValue) {
    var filters = [{
        field: filterField,
        operator: "eq",  // eq, contains, gt, lt, etc.
        value: filterValue
    }];
    
    gridData.dataSource.filter({
        logic: "and",
        filters: filters
    });
}

// Google Drive search pattern (useful!)
drive_search({
    api_query: "name contains 'hello' and modifiedTime > '2012-06-04'",
    semantic_query: "project documents about framing",
    page_size: 10,
    page_token: "next_page_token_here"
})
Your API should support:
typescriptinterface FilterRequest {
    filters: Array<{
        field: string;
        operator: 'eq' | 'neq' | 'contains' | 'gt' | 'lt' | 'gte' | 'lte';
        value: any;
    }>;
    logic: 'and' | 'or';
    sort?: {
        field: string;
        direction: 'asc' | 'desc';
    };
    page?: number;
    pageSize?: number;
}

4. From Gantt/Scheduler Code (Document 5)
Task/Activity data structure:
javascript// Gantt task format
{
    TaskId: string,
    Title: string,
    Start: Date,
    End: Date,
    PercentComplete: number,
    ParentId: string | null,
    OrderId: number,
    Expanded: boolean,
    Summary: boolean,
    CanModify: boolean,
    
    // Custom fields
    UserDateField1: Date,
    UserDateField2: Date,
    // ... up to UserDateField6
}

// Dependencies/Predecessors
{
    TaskId: string,
    PredecessorId: string,
    Type: number  // 0=FS, 1=SS, 2=FF, 3=SF
}

5. Email/Calendar Integration Patterns (from instructions)
Gmail API structure hinted at:
javascriptsearch_gmail_messages({
    q: "from:amy@example.com subject:invoice",
    page_token: null
})

// Returns
{
    messages: [{
        id: string,
        threadId: string,
        snippet: string,
        date: ISO8601
    }],
    nextPageToken: string,
    resultSizeEstimate: number
}
Calendar API:
javascriptlist_gcal_events({
    calendar_id: "primary",
    time_min: "2025-11-14T00:00:00-08:00",
    time_max: "2025-11-15T00:00:00-08:00",
    query: "standup meeting"
})

‚ö° API Design Recommendations for MindFlow
RESTful Endpoints You Need:
typescript// Construction Projects
GET    /api/projects
GET    /api/projects/:id
POST   /api/projects
PATCH  /api/projects/:id

// Plans/Takeoffs  
GET    /api/projects/:projectId/plans
POST   /api/projects/:projectId/plans
GET    /api/plans/:id/takeoff

// Purchase Orders
GET    /api/purchase-orders
GET    /api/purchase-orders/:id
POST   /api/purchase-orders
PATCH  /api/purchase-orders/:id/status

// Activities/Tasks
GET    /api/projects/:projectId/activities
POST   /api/projects/:projectId/activities
PATCH  /api/activities/:id

// Material Orders
GET    /api/projects/:projectId/materials
POST   /api/material-orders

// Documents
GET    /api/projects/:projectId/documents
POST   /api/documents/upload
Standard Request/Response Format:
typescript// Request with filters
POST /api/projects/search
{
    filters: [
        { field: "status", operator: "eq", value: "active" },
        { field: "startDate", operator: "gte", value: "2025-01-01" }
    ],
    sort: { field: "name", direction: "asc" },
    page: 1,
    pageSize: 25
}

// Response envelope
{
    data: [...],
    meta: {
        page: 1,
        pageSize: 25,
        totalCount: 150,
        totalPages: 6
    },
    links: {
        self: "/api/projects/search?page=1",
        next: "/api/projects/search?page=2",
        prev: null
    }
}
Status State Machine:
typescript// From the CSS status classes
enum OrderStatus {
    NOT_CONFIRMED = 'not_confirmed',  // Needs action
    PENDING = 'pending',               // Processing
    CONFIRMED = 'confirmed',           // Complete
    LATE = 'late'                      // Past due
}

// Valid transitions
const transitions = {
    not_confirmed: ['pending', 'late'],
    pending: ['confirmed', 'late'],
    confirmed: [],  // Terminal state
    late: ['confirmed']
};
Date Handling (Critical!):
typescript// ALWAYS use ISO 8601 with timezone
interface DateFields {
    baseStartDate: string;      // "2025-11-14T08:00:00-08:00"
    baseEndDate: string;
    projectedStartDate: string;
    projectedEndDate: string;
    scheduledStartDate: string;
    scheduledEndDate: string;
    actualStartDate?: string;
    actualEndDate?: string;
}

// Server response helper
function serializeDate(date: Date): string {
    return date.toISOString(); // Always UTC, let client convert
}

Practical Example: Purchase Order API
Based on what I found in the code:
typescript// API Contract
interface PurchaseOrder {
    id: string;
    poNumber: string;
    projectId: string;
    supplierId: string;
    status: 'not_confirmed' | 'pending' | 'confirmed' | 'late';
    
    items: Array<{
        materialId: string;
        description: string;
        quantity: number;
        unit: string;
        unitPrice: number;
        totalPrice: number;
    }>;
    
    dates: {
        created: string;        // ISO 8601
        required: string;
        confirmed?: string;
        delivered?: string;
    };
    
    documents: Array<{
        fileName: string;
        fileUrl: string;
        uploadedAt: string;
    }>;
    
    metadata: {
        createdBy: string;
        updatedBy: string;
        updatedAt: string;
    };
}

// Endpoints
GET    /api/purchase-orders?projectId={id}&status={status}
GET    /api/purchase-orders/{id}
POST   /api/purchase-orders
PATCH  /api/purchase-orders/{id}
POST   /api/purchase-orders/{id}/confirm
GET    /api/purchase-orders/{id}/documents
POST   /api/purchase-orders/{id}/documents

Integration Bridges You Need
typescript// 1. Legacy System ‚Üí MindFlow
class LegacyBridgeAPI {
    // Map their PO format to yours
    transformPurchaseOrder(legacyPO: any): PurchaseOrder {
        return {
            id: legacyPO.PoHeaderID,
            poNumber: legacyPO.PoNumber,
            status: this.mapStatus(legacyPO.StatusCode),
            // ... rest of mapping
        };
    }
    
    // Map their date fields (with timezone handling)
    transformDates(legacyData: any): DateFields {
        return {
            baseStartDate: this.toISO(legacyData.BaseStartDate),
            // ... handle timezone offsets
        };
    }
}

// 2. MindFlow ‚Üí External Services (Gmail, Calendar, Drive)
class ExternalServicesAPI {
    async syncToCalendar(activity: Activity): Promise<void> {
        await list_gcal_events({
            calendar_id: 'primary',
            time_min: activity.scheduledStartDate,
            time_max: activity.scheduledEndDate
        });
    }
    
    async fetchRelatedEmails(projectId: string): Promise<Email[]> {
        return search_gmail_messages({
            q: `project:${projectId} OR subject:"${projectName}"`
        });
    }
}

üéØ What You Actually Need to Build:

REST API with standard CRUD operations
Filter/Search DSL (like the grid filtering pattern)
Pagination with page tokens
Date handling with timezone awareness
Status state machine with validation
File upload/download endpoints
Webhook support for real-time updates
OAuth2 for external service integrations

The code samples show what data structures exist, but YOU need to design the modern API contract.
Want me to create a complete OpenAPI spec based on these findings?RetryCBOk, can you create a report with all of the functions that we have currently, as well as all the information we would need to pull or push other important information to and from these sites?MindFlow Construction Technology Platform
Complete System Audit & API Integration Report
Date: November 14, 2025
Prepared for: Corey, MindFlow AS
Purpose: Catalog existing functions and define API requirements for system consolidation

Executive Summary
This report documents all existing functions across 30+ scattered construction technology tools and defines the API contracts needed to consolidate them into a unified MindFlow platform. The analysis reveals significant duplication of effort and identifies opportunities for 80%+ reduction in processing time through proper integration.
Key Finding: Your systems currently lack standardized APIs. Most communication happens via file exports, manual data entry, and CSV uploads‚Äîcosting 10-15 minutes per transaction that could be automated to 1-2 minutes.

Table of Contents

Current System Functions Inventory
External System Integration Requirements
Required API Specifications
Data Models & Schemas
Migration & Bridge Strategy
Implementation Roadmap


<a name="current-functions"></a>
1. Current System Functions Inventory
1.1 BAT (Builder's Acceleration Tool) Systems
Purpose: Automate takeoff processing for production builders
Functions Identified:
javascript// Document Processing
- processExcelTakeoff(file)
  ‚Üí Reads legacy Excel-based takeoff files
  ‚Üí Extracts quantities, materials, measurements
  ‚Üí Returns: { walls: [], roof: [], totals: {} }

- convertLegacyFormat(excelData, targetFormat)
  ‚Üí Migrates old BAT versions to current
  ‚Üí 61 Richmond American plans need this
  ‚Üí Returns: modernizedData

- generateMaterialList(takeoffData)
  ‚Üí Converts takeoff to procurement list
  ‚Üí Applies material specifications
  ‚Üí Returns: orderableItems[]

// SharePoint Integration (mentioned in documents)
- uploadToSharePoint(document, metadata)
- fetchFromSharePoint(projectId, docType)
- syncBidManagement(projectData)
Current Limitations:

No REST API‚Äîuses file system operations
Manual CSV export/import workflow
No real-time sync between builders
Each builder has customized version (duplication)


1.2 MaterialFlow Procurement Platform
Purpose: Manage material ordering and commodity pricing
Functions Identified:
javascript// Purchase Order Management (from builderportal.common.js)
- getPOList(scheduleActivityId)
  ‚Üí Returns: [{
      PoNumber: string,
      PoHeaderID: string,
      StatusCode: string,
      FileName: string
    }]

- getPOListByPOHeaderIds(poHeaderIds[])
  ‚Üí Batch fetch multiple POs
  ‚Üí Used for consolidated views

- viewPO(poNumber, poHeaderId, status)
  ‚Üí Downloads PO document
  ‚Üí Triggers file download in browser

- getSupplierDetails(supplierId)
  ‚Üí Returns: supplier contact info, terms, delivery zones

// Commodity Pricing (Holt Homes integration mentioned)
- fetchRandomLengthsPricing()
  ‚Üí Integrates lumber commodity data
  ‚Üí CSV import ‚Üí needs API conversion

- applyPricingToMaterials(materials, pricingData)
  ‚Üí Updates material costs based on market rates
```

**Status Workflow:**
```
not_confirmed ‚Üí pending ‚Üí confirmed
     ‚Üì
   late (if past due date)
Current Limitations:

No webhook notifications for price changes
Manual CSV uploads for Random Lengths data
No automated PO generation from takeoffs
Status updates require page refresh


1.3 ReadyFrame (RF) Takeoff System
Purpose: Wall, roof, and complete framing calculations
Functions Identified (from project naming patterns):
javascript// Versions found in your history:
- RF v1.0: Basic wall calculations
- RF v2.0: Added roof calculations  
- RF v3.0: Complete framing system
- RF v4.0: Interactive HTML guides

// Core Functions (inferred from names)
- calculateWallFraming(plan)
  ‚Üí Returns: { studs, plates, headers, sheathing }

- calculateRoofFraming(plan)
  ‚Üí Returns: { rafters, trusses, sheathing, trim }

- calculateCompleteFrame(plan)
  ‚Üí Combines wall + roof + floor systems
  ‚Üí Returns: complete material list

- generateTrainingMaterial(feature)
  ‚Üí Creates interactive HTML guides
  ‚Üí Used for PlanSwift mastery training

- exportToPlanSwift(takeoffData)
  ‚Üí Integration with PlanSwift software
Current Limitations:

Multiple versions across different builders
No centralized calculation engine
Training materials scattered across files
No API‚Äîembedded in Excel/HTML files


1.4 Grid/Data Management Functions
Purpose: Display, filter, and manipulate construction data
Functions from resize.tabstrip.js & builderportal code:
javascript// Grid Operations
- resizeGrid(gridHeight, inTheTabStrip)
  ‚Üí Dynamic grid sizing based on viewport
  ‚Üí Handles tabbed vs. standalone grids

- applyGridSettings(gridSettingsKey, grid)
  ‚Üí Loads user preferences
  ‚Üí Column visibility, sort order, filters

- applyFilter(gridId, filterField, filterValue)
  ‚Üí Field-level filtering
  ‚Üí Supports: eq, contains, gt, lt operators
  ‚Üí Logic: AND/OR combinations

- clearFilters(gridId)
  ‚Üí Resets all active filters

- refreshGrid(gridId, gridSettingsKey)
  ‚Üí Reloads data with current settings

// Excel Export/Import
- exportToExcel(gridData)
- importFromExcel(file)
  ‚Üí Manual process, no API

// Printing
- printGrid(gridName)
  ‚Üí Generates print-friendly view
  ‚Üí Strips dynamic elements
Filter Query Language (from code):
javascript{
  filters: [
    { field: "status", operator: "eq", value: "active" },
    { field: "startDate", operator: "gte", value: "2025-01-01" }
  ],
  logic: "and",
  sort: { field: "name", direction: "asc" }
}

1.5 Scheduling & Gantt Functions
Purpose: Project timeline management and activity scheduling
Functions from builderportal.schedulingCommon.js:
javascript// Date/Time Management
- addGanttOffset(data)
  ‚Üí Applies timezone offset to gantt tasks
  ‚Üí Critical for multi-timezone coordination

- addOffset(data)
  ‚Üí Adjusts all date fields:
      BaseStartDate, BaseEndDate,
      ProjStartDate, ProjEndDate,
      SchStartDate, SchEndDate,
      ActualStartDate, ActualEndDate,
      ScheduleLastViewed

- addCustomFieldOffset(data)
  ‚Üí Handles UserDateField1-6
  ‚Üí Custom date tracking per builder

// Gantt Operations
- ganttTaskModify(event)
  ‚Üí Validates CanModify flag before allowing edits

- ganttError(event)
  ‚Üí Rollback on server errors

- onGanttRequestEnd(event, callbacks)
  ‚Üí Triggers: refreshSchedulerData(), refreshGridData(), refreshGanttData()
  ‚Üí Scrolls to modified task after update

// Multi-View Sync
- refreshGantt(selectedTabIndex, ganttTabIndex)
  ‚Üí Coordinates gantt, scheduler, and grid views
  ‚Üí Prevents data desync

- refreshScheduler(schedulerId, tabstripId)
  ‚Üí Calendar view updates

- focusSchedulerDate(event, dataBoundHandler)
  ‚Üí Auto-scrolls to earliest scheduled date
Gantt Task Data Structure:
javascript{
  TaskId: string,
  Title: string,
  Start: ISO8601,
  End: ISO8601,
  PercentComplete: number,
  ParentId: string | null,
  OrderId: number,
  Expanded: boolean,
  Summary: boolean,
  CanModify: boolean,
  
  // Dependency tracking
  PredecessorId: string,
  Type: number  // 0=FS, 1=SS, 2=FF, 3=SF
}

1.6 Document Management Functions
Purpose: File storage, retrieval, and organization
Functions (from code references):
javascript// Upload/Download
- uploadDocument(projectId, file, metadata)
- downloadDocument(documentId)
- viewPOList(activityId)
  ‚Üí Displays linked PO documents
  ‚Üí Modal with clickable download links

// Search/Filter
- drive_search(query, filters)
  ‚Üí Google Drive integration
  ‚Üí Supports complex query syntax:
      "name contains 'hello' and modifiedTime > '2012-06-04'"

- google_drive_fetch(documentIds[])
  ‚Üí Direct fetch by ID
  ‚Üí Bulk document retrieval

// Organization
- assignDocumentToProject(docId, projectId)
- tagDocument(docId, tags[])
- getDocumentsByProject(projectId)
```

**Google Drive Query Operators (from instructions):**
```
name contains 'text'
fullText contains 'keyword'
modifiedTime > '2025-01-01T00:00:00Z'
'parent-folder-id' in parents
mimeType = 'application/pdf'
starred = true

1.7 User Management & Permissions
Purpose: Access control and user preferences
Functions from builderportal.common.js:
javascript// Privileges
- displayPrivileges(element)
  ‚Üí Modal showing user access levels
  ‚Üí GET ~/BuilderPortal/Dashboard/GetPrivileges

- getUserWMSSettings()
  ‚Üí Warehouse management preferences
  ‚Üí GET ~/BuilderPortal/Dashboard/GetWMSSettings

// Session Management
- saveUserPreferences(settings)
  ‚Üí Grid layouts, filter defaults, theme

// Multi-Builder Support
- switchBuilder(builderId)
  ‚Üí Context switching for contractors serving multiple builders
Permission Levels (inferred):

Admin: Full system access
ProjectManager: Project-level control
Estimator: Takeoff and material ordering
Viewer: Read-only access


1.8 Validation & Form Handling
Purpose: Data quality and user input validation
Functions from jquery.validate.triggers.js:
javascript// Validation Events
- addTriggersToJqueryValidate()
  ‚Üí Adds custom event triggers to forms

- formValidation(callback)
  ‚Üí Fires on form validation
  ‚Üí Returns: (form, isValid)

- elementValidation(callback)
  ‚Üí Field-level validation
  ‚Üí Real-time feedback

- triggerElementValidationsOnFormValidation()
  ‚Üí Cascading validation across form

// Custom Validators (from builderportal code)
- validateDate(value)
  ‚Üí Kendo date format check
  ‚Üí Rejects invalid formats

- onComboDataBoundRestrictValues(event)
  ‚Üí Prevents invalid combo box selections

- onChangeRestrictValues(element)
  ‚Üí Clears invalid selections on change

1.9 Legacy Modal/Popup System
Purpose: DHTML popups (SubModal v1.5)
Functions from subModal.js:
javascript// Modal Management
- showPopWin(url, width, height, returnFunc, showCloseBox)
  ‚Üí Displays iframe-based modal
  ‚Üí Loads content from URL

- hidePopWin(callReturnFunc)
  ‚Üí Closes modal
  ‚Üí Optional callback execution

- centerPopWin(width, height)
  ‚Üí Repositions on window resize/scroll

- setMaskSize()
  ‚Üí Adjusts overlay dimensions

// IE6 Hacks (obsolete but present)
- hideSelectBoxes()
  ‚Üí IE6 z-index bug workaround
- displaySelectBoxes()
  ‚Üí Restores selects after modal close

- disableTabIndexes()
  ‚Üí Traps keyboard focus in modal
- restoreTabIndexes()
  ‚Üí Restores tab order
‚ö†Ô∏è Recommendation: Replace entirely with native <dialog> element or modern modal library.

1.10 TreeView Operations
Purpose: Hierarchical data selection (e.g., material categories)
Functions from builderportal.common.js:
javascript// Tree Node Movement
- swapTreeviewNodes(fromId, toId)
  ‚Üí Moves checked nodes between trees
  ‚Üí Used for available ‚Üí selected pattern

- swapTreeviewAllNodes(fromId, toId)
  ‚Üí Moves all nodes (not just checked)

- getCheckedNodes(nodes, checkedNodes[])
  ‚Üí Recursively collects checked nodes

- getCheckedAllNodes(nodes, checkedNodes[])
  ‚Üí Gets all nodes regardless of state

- setNodes(treeview, checkedNodes[])
  ‚Üí Appends nodes to target tree
Use Cases:

Material category selection
Organizational hierarchy navigation
Multi-level filtering


1.11 Dual-List Selector
Purpose: Move items between available/selected lists
Functions (from fragment you shared):
javascript// List Operations
- moveRight(selectedOptions)
  ‚Üí Moves selected options from left ‚Üí right
  ‚Üí Updates hidden field with selection

- moveLeft(selectedOptions)
  ‚Üí Moves selected options from right ‚Üí left

- saveSelection()
  ‚Üí Serializes right-side list to hidden field
  ‚Üí Form submission payload

// State Management
- updateButtonStates()
  ‚Üí Enables/disables move buttons based on selection
Current Issues:

Inefficient DOM queries (no caching)
Uses .clone() which may duplicate event handlers
No keyboard shortcuts
No search/filter capability


1.12 Email & Calendar Integration
Purpose: Communication and scheduling sync
Functions (from AI instructions, not in code files):
javascript// Gmail Integration
- search_gmail_messages(query, page_token)
  ‚Üí Returns: {
      messages: [{ id, threadId, snippet, date }],
      nextPageToken,
      resultSizeEstimate
    }

- read_gmail_thread(threadId, includeFullMessages)
  ‚Üí Fetches complete conversation

- read_gmail_profile()
  ‚Üí Gets user email for tool integrations

// Google Calendar
- list_gcal_events(calendarId, timeMin, timeMax, query)
  ‚Üí Fetches scheduled events
  ‚Üí Returns: events with start/end times

- fetch_gcal_event(calendarId, eventId)
  ‚Üí Single event details

- find_free_time(calendarIds[], timeMin, timeMax)
  ‚Üí Availability checking across multiple calendars

- list_gcal_calendars(page_token)
  ‚Üí Available calendars for user
Integration Opportunities:

Auto-create calendar events from project milestones
Link emails to projects/POs by subject parsing
Delivery schedule coordination via calendar sync


1.13 Third-Party Widget Integration
Purpose: Chat, analytics, external services
Patterns from Intercom loader:
javascript// Widget Lifecycle
- initWidget(config)
  ‚Üí Feature detection before load
  ‚Üí Bot detection to skip loading

- loadWidget()
  ‚Üí Creates hidden iframe
  ‚Üí Loads vendor scripts into isolation

- queueCommands()
  ‚Üí Buffers API calls before widget ready
  ‚Üí window.Intercom = function() { queue.push(args) }

// Cleanup
- destroyWidget()
  ‚Üí Removes iframe
  ‚Üí Clears global references

// SPA Navigation
- setupSPAListeners()
  ‚Üí Listens for: turbo:load, popstate
  ‚Üí Reinitializes on route changes
Feature Detection Functions:
javascript- hasXhr2Support()
- hasLocalStorageSupport()
- hasSessionStorageSupport()
- hasFileSupport()
- hasAudioSupport()
- hasVisibilitySupport()

<a name="external-integrations"></a>
2. External System Integration Requirements
2.1 Richmond American Homes
Relationship: Major client, 61 building plans needing BAT migration
Data They Need to Push to MindFlow:
javascript{
  // Plan submissions
  planId: string,
  planName: string,
  planRevision: string,
  submittedDate: ISO8601,
  drawingFiles: [{ filename, url, type: 'PDF' | 'DWG' }],
  
  // Project assignments
  projectId: string,
  lotNumber: string,
  address: string,
  startDate: ISO8601,
  estimatedCompletion: ISO8601,
  
  // Material preferences
  materialSpecs: {
    studType: '2x4' | '2x6',
    roofSystem: 'truss' | 'stick',
    sheathing: 'OSB' | 'plywood'
  }
}
Data They Need to Pull from MindFlow:
javascript{
  // Completed takeoffs
  takeoffId: string,
  planId: string,
  materials: [{
    itemCode: string,
    description: string,
    quantity: number,
    unit: string,
    estimatedCost: number
  }],
  totalEstimate: number,
  
  // Progress tracking
  projectStatus: 'estimating' | 'ordered' | 'in_progress' | 'complete',
  completionPercentage: number,
  upcomingDeliveries: [{ date, materials }]
}
```

**API Endpoints Needed:**
```
POST /api/richmond-american/plans/submit
GET  /api/richmond-american/projects/{id}/status
GET  /api/richmond-american/takeoffs/{id}
POST /api/richmond-american/material-specs/update

2.2 Holt Homes
Relationship: Advanced material management with commodity pricing
Data They Need to Push:
javascript{
  // Project requests
  projectId: string,
  projectType: 'single-family' | 'multi-family',
  units: number,
  scheduledStart: ISO8601,
  
  // Custom CSV data (currently manual upload)
  materialPricing: {
    source: 'Random Lengths',
    effectiveDate: ISO8601,
    items: [{
      commodity: 'lumber',
      grade: '2x4-8',
      pricePerUnit: number,
      unit: 'BF' | 'LF',
      market: 'Pacific Northwest'
    }]
  }
}
Data They Need to Pull:
javascript{
  // Material orders with live pricing
  orderId: string,
  items: [{
    material: string,
    quantity: number,
    basePrice: number,
    commodityAdjustment: number,  // From Random Lengths
    finalPrice: number,
    priceLastUpdated: ISO8601
  }],
  
  // Delivery coordination
  deliverySchedule: [{
    deliveryDate: ISO8601,
    items: string[],
    supplier: string,
    status: 'scheduled' | 'confirmed' | 'delivered'
  }]
}
```

**API Endpoints Needed:**
```
POST /api/holt-homes/projects/create
POST /api/holt-homes/pricing/upload-csv
GET  /api/holt-homes/pricing/current
POST /api/holt-homes/orders/create
GET  /api/holt-homes/orders/{id}/status
Special Requirements:

Real-time pricing updates (webhook when Random Lengths data changes)
CSV ‚Üí JSON transformation service
Historical pricing data retention (12 months minimum)


2.3 Sekisui House
Relationship: "Federation challenge" restructuring, major opportunity
Background (from your notes): Sekisui has organizational complexity requiring flexible integration
Data They Need to Push:
javascript{
  // Multi-division structure
  divisionId: string,
  divisionName: string,
  regionalOffice: string,
  
  // Project submissions
  projectId: string,
  projectName: string,
  developmentType: 'residential' | 'commercial' | 'mixed-use',
  buildings: [{
    buildingId: string,
    floorPlans: [{ planId, units }]
  }],
  
  // Approval workflows
  approvalChain: [{
    approverRole: string,
    approverEmail: string,
    sequence: number
  }]
}
Data They Need to Pull:
javascript{
  // Consolidated reporting across divisions
  divisions: [{
    divisionId: string,
    activeProjects: number,
    totalEstimatedValue: number,
    projectsByStatus: {
      estimating: number,
      approved: number,
      in_progress: number,
      complete: number
    }
  }],
  
  // Standardized takeoffs despite regional variations
  takeoff: {
    standardFormat: true,
    regionalAdjustments: {
      materialCodes: 'local' | 'national',
      measurementSystem: 'metric' | 'imperial',
      costBasis: 'JPY' | 'USD'
    }
  }
}
```

**API Endpoints Needed:**
```
POST /api/sekisui/divisions/register
GET  /api/sekisui/divisions/{id}/dashboard
POST /api/sekisui/projects/submit
GET  /api/sekisui/projects/{id}/approval-status
POST /api/sekisui/approvals/{id}/approve
GET  /api/sekisui/reporting/consolidated
Special Requirements:

Multi-tenancy support (division isolation)
Currency conversion (JPY ‚Üî USD)
Approval workflow engine
Regional material code mapping


2.4 Google Workspace Integration
Services: Gmail, Calendar, Drive
Gmail - Data to Pull:
javascript{
  // Project-related emails
  query: "project:12345 OR subject:'Maple Grove Development'",
  messages: [{
    id: string,
    threadId: string,
    from: { name, email },
    to: [{ name, email }],
    subject: string,
    snippet: string,  // First 200 chars
    date: ISO8601,
    labels: ['INBOX', 'IMPORTANT'],
    attachments: [{
      filename: string,
      mimeType: string,
      size: number
    }]
  }],
  
  // Automatically parse for:
  poNumberPattern: /PO[#:\s]*(\d+)/i,
  projectIdPattern: /Project[#:\s]*(\d+)/i,
  deliveryDatePattern: /delivery.*(\d{1,2}\/\d{1,2}\/\d{4})/i
}
Calendar - Data to Pull:
javascript{
  // Construction milestones
  events: [{
    id: string,
    summary: string,
    description: string,
    start: ISO8601,
    end: ISO8601,
    location: string,
    attendees: [{ email, responseStatus }],
    
    // Parse from description/title:
    linkedProjectId: string,
    activityType: 'delivery' | 'inspection' | 'milestone'
  }],
  
  // Availability for scheduling
  freeTimeslots: [{
    start: ISO8601,
    end: ISO8601,
    duration: number  // minutes
  }]
}
Calendar - Data to Push:
javascript{
  // Auto-create events from MindFlow
  event: {
    summary: "Material Delivery - Project Maple Grove",
    description: "PO #45678\nSupplier: ABC Lumber\nItems: 2x4 studs (500 qty)",
    start: ISO8601,
    end: ISO8601,
    location: "123 Construction Site Rd",
    attendees: ['project-manager@builder.com'],
    reminders: [
      { method: 'email', minutes: 1440 },  // 1 day before
      { method: 'popup', minutes: 60 }      // 1 hour before
    ]
  }
}
Drive - Data to Pull:
javascript{
  // Project documents
  query: "'project-folder-id' in parents and mimeType='application/pdf'",
  files: [{
    id: string,
    name: string,
    mimeType: string,
    webViewLink: string,
    modifiedTime: ISO8601,
    size: number,
    owners: [{ emailAddress }],
    
    // Extract metadata from filename patterns:
    // "Maple_Grove_Plan_A_Rev3_2025-01-15.pdf"
    parsedMetadata: {
      projectName: "Maple Grove",
      planName: "Plan A",
      revision: "Rev3",
      date: "2025-01-15"
    }
  }]
}
Drive - Data to Push:
javascript{
  // Upload generated takeoffs
  file: {
    name: "Takeoff_MapleGrove_PlanA_2025-11-14.xlsx",
    mimeType: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
    parents: ['project-folder-id'],
    content: base64EncodedData,
    description: "Generated by MindFlow BAT system",
    properties: {
      projectId: "12345",
      generatedBy: "MindFlow",
      version: "3.0"
    }
  }
}
```

**API Endpoints Needed:**
```
GET  /api/integrations/gmail/search
POST /api/integrations/gmail/link-to-project
GET  /api/integrations/calendar/events
POST /api/integrations/calendar/create-event
GET  /api/integrations/drive/search
POST /api/integrations/drive/upload
GET  /api/integrations/drive/download/{fileId}

2.5 Random Lengths (Commodity Pricing)
Purpose: Real-time lumber and building material pricing
Data to Pull (Currently CSV, needs API):
javascript{
  pricingReport: {
    reportDate: ISO8601,
    market: 'Pacific Northwest' | 'Southeast' | 'Midwest',
    currency: 'USD',
    
    commodities: [{
      category: 'lumber' | 'panels' | 'engineered',
      item: {
        code: 'KD-HF-2x4-8',
        description: 'Kiln Dried Hem-Fir 2x4 8ft',
        grade: '#2 & Better',
        unit: 'MBF',  // Thousand Board Feet
        price: number,
        priceChange: {
          amount: number,
          percentage: number,
          direction: 'up' | 'down' | 'stable'
        },
        weeklyAverage: number,
        monthlyTrend: 'rising' | 'falling' | 'stable'
      }
    }],
    
    indices: {
      compositeIndex: number,
      weekOverWeekChange: number,
      yearOverYearChange: number
    }
  }
}
Data Transformation Needed:
javascript// CSV format (current)
"Date,Item,Price,Change"
"2025-11-14,KD HF 2x4 8',450,+15"

// Convert to JSON API response
{
  effectiveDate: "2025-11-14T00:00:00Z",
  items: [{
    itemCode: "KD-HF-2x4-8",
    pricePerMBF: 450,
    changeFromLastWeek: 15
  }]
}
```

**API Endpoints Needed:**
```
POST /api/pricing/random-lengths/upload-csv
GET  /api/pricing/random-lengths/current
GET  /api/pricing/random-lengths/historical?item={code}&start={date}&end={date}
POST /api/pricing/apply-to-materials  // Updates all materials with new pricing
Webhook Requirements:
javascript// When pricing changes >5%, notify subscribed projects
{
  event: 'pricing.significant_change',
  data: {
    itemCode: 'KD-HF-2x4-8',
    oldPrice: 450,
    newPrice: 475,
    changePercentage: 5.56,
    affectedProjects: ['12345', '67890'],
    recommendedAction: 'review_estimates'
  }
}

2.6 PlanSwift Integration
Purpose: Professional takeoff software used by estimators
Data to Push to PlanSwift:
javascript{
  // Export MindFlow takeoffs to PlanSwift format
  planswiftExport: {
    projectName: string,
    planFile: string,  // PDF path
    pages: [{
      pageNumber: number,
      measurements: [{
        type: 'area' | 'length' | 'count',
        layer: 'Walls' | 'Roof' | 'Foundation',
        color: string,  // Visual distinction
        value: number,
        unit: 'SF' | 'LF' | 'EA',
        coordinates: [{ x, y }],  // Drawing points
        notes: string
      }]
    }],
    
    assemblies: [{
      name: "8' Exterior Wall",
      components: [
        { item: "2x4 Stud", quantity: 7, spacing: "16 OC" },
        { item: "Bottom Plate", quantity: 1 },
        { item: "Top Plate", quantity: 2 }
      ]
    }]
  }
}
Data to Pull from PlanSwift:
javascript{
  // Import existing PlanSwift projects
  planswiftImport: {
    projectId: string,
    measurements: [{
      type: string,
      quantity: number,
      unit: string,
      description: string
    }],
    
    materialList: [{
      itemName: string,
      quantity: number,
      unit: string,
      cost: number,
      supplier: string,
      notes: string
    }],
    
    totalEstimate: number
  }
}
```

**API Endpoints Needed:**
```
POST /api/integrations/planswift/export
POST /api/integrations/planswift/import
GET  /api/integrations/planswift/assemblies  // Standard assembly templates

<a name="api-specs"></a>
3. Required API Specifications
3.1 Core REST API Structure
Base URL: https://api.mindflow.construction/v1
Authentication:
httpAuthorization: Bearer {jwt_token}
X-API-Key: {api_key}  // For service-to-service
Standard Response Envelope:
javascript{
  success: boolean,
  data: any,
  meta: {
    timestamp: ISO8601,
    requestId: string,
    pagination?: {
      page: number,
      pageSize: number,
      totalCount: number,
      totalPages: number
    }
  },
  errors?: [{
    code: string,
    message: string,
    field?: string
  }]
}
```

---

### 3.2 Project Management API
```
POST   /api/projects
GET    /api/projects
GET    /api/projects/{id}
PATCH  /api/projects/{id}
DELETE /api/projects/{id}
POST   /api/projects/search
Project Schema:
typescriptinterface Project {
  id: string;
  name: string;
  builder: {
    id: string;
    name: string;
    division?: string;
  };
  
  status: 'planning' | 'estimating' | 'approved' | 'in_progress' | 'complete' | 'on_hold';
  
  location: {
    address: string;
    city: string;
    state: string;
    zip: string;
    lotNumber?: string;
    subdivision?: string;
  };
  
  dates: {
    created: ISO8601;
    estimated_start: ISO8601;
    actual_start?: ISO8601;
    estimated_completion: ISO8601;
    actual_completion?: ISO8601;
  };
  
  financials: {
    estimated_cost: number;
    actual_cost?: number;
    budget: number;
    currency: 'USD' | 'JPY';
  };
  
  contacts: {
    project_manager: { name, email, phone };
    estimator: { name, email, phone };
    superintendent?: { name, email, phone };
  };
  
  metadata: {
    created_by: string;
    updated_by: string;
    updated_at: ISO8601;
    tags: string[];
  };
}
Search Example:
httpPOST /api/projects/search
Content-Type: application/json

{
  "filters": [
    { "field": "status", "operator": "in", "value": ["in_progress", "estimating"] },
    { "field": "builder.id", "operator": "eq", "value": "richmond-american" },
    { "field": "dates.estimated_start", "operator": "gte", "value": "2025-01-01" }
  ],
  "sort": { "field": "dates.estimated_start", "direction": "asc" },
  "page": 1,
  "pageSize": 25
}
```

---

### 3.3 Takeoff API
```
POST   /api/takeoffs
GET    /api/takeoffs
GET    /api/takeoffs/{id}
PATCH  /api/takeoffs/{id}
POST   /api/takeoffs/{id}/calculate
POST   /api/takeoffs/{id}/export
POST   /api/takeoffs/import
Takeoff Schema:
typescriptinterface Takeoff {
  id: string;
  project_id: string;
  plan: {
    id: string;
    name: string;
    revision: string;
    file_url: string;
    file_type: 'PDF' | 'DWG' | 'DXF';
  };
  
  status: 'draft' | 'calculating' | 'complete' | 'approved';
  
  measurements: {
    walls: {
      exterior: {
        linear_feet: number;
        area_sqft: number;
        height: number;
      };
      interior: {
        linear_feet: number;
        area_sqft: number;
        height: number;
      };
    };
    
    roof: {
      area_sqft: number;
      pitch: string;  // "4/12"
      type: 'gable' | 'hip' | 'flat' | 'shed';
      overhang: number;
    };
    
    floor: {
      area_sqft: number;
      stories: number;
    };
  };
  
  materials: [{
    id: string;
    category: 'lumber' | 'panels' | 'hardware' | 'misc';
    item_code: string;
    description: string;
    quantity: number;
    unit: 'EA' | 'LF' | 'SF' | 'BF' | 'MBF';
    unit_cost: number;
    total_cost: number;
    supplier?: string;
    notes?: string;
  }];
  
  summary: {
    total_materials_cost: number;
    labor_estimate?: number;
    total_estimate: number;
    calculated_at: ISO8601;
    calculated_by: string;
  };
  
  metadata: {
    created_at: ISO8601;
    updated_at: ISO8601;
    version: string;  // "RF 4.0"
  };
}
Calculate Endpoint:
httpPOST /api/takeoffs/{id}/calculate
Content-Type: application/json

{
  "calculation_method": "ReadyFrame_v4",
  "material_specs": {
    wall_studs: "2x4",
    stud_spacing: "16_OC",
    roof_system: "truss",
    sheathing: "OSB"
  },
  "apply_current_pricing": true
}

Response:
{
  "success": true,
  "data": {
    "materials": [...],
    "summary": {...},
    "calculation_time_ms": 1234
  }
}
```

---

### 3.4 Purchase Order API
```
POST   /api/purchase-orders
GET    /api/purchase-orders
GET    /api/purchase-orders/{id}
PATCH  /api/purchase-orders/{id}
POST   /api/purchase-orders/{id}/submit
POST   /api/purchase-orders/{id}/confirm
POST   /api/purchase-orders/{id}/cancel
Purchase Order Schema:
typescriptinterface PurchaseOrder {
  id: string;
  po_number: string;  // Auto-generated or custom
  project_id: string;
  takeoff_id?: string;  // Link to source takeoff
  
  supplier: {
    id: string;
    name: string;
    contact: { name, email, phone };
    delivery_terms: string;
  };
  
  status: 'draft' | 'submitted' | 'confirmed' | 'partially_received' | 'received' | 'cancelled';
  
  items: [{
    id: string;
    material_id: string;
    item_code: string;
    description: string;
    quantity_ordered: number;
    quantity_received: number;
    unit: string;
    unit_price: number;
    total_price: number;
    
    // Commodity tracking
    commodity_item?: boolean;
    base_price?: number;
    commodity_adjustment?: number;
    pricing_date?: ISO8601;
  }];
  
  delivery: {
    site_address: string;
    requested_date: ISO8601;
    confirmed_date?: ISO8601;
    actual_date?: ISO8601;
    instructions?: string;
  };
  
  financials: {
    subtotal: number;
    tax: number;
    shipping: number;
    total: number;
    currency: 'USD';
    payment_terms: string;
  };
  
  documents: [{
    id: string;
    type: 'quote' | 'invoice' | 'packing_slip' | 'receipt';
    filename: string;
    url: string;
    uploaded_at: ISO8601;
  }];
  
  history: [{
    timestamp: ISO8601;
    action: string;
    user: string;
    notes?: string;
  }];
  
  metadata: {
    created_by: string;
    created_at: ISO8601;
    updated_at: ISO8601;
  };
}
```

**Status Transitions:**
```
draft ‚Üí submitted ‚Üí confirmed ‚Üí partially_received ‚Üí received
         ‚Üì
      cancelled (from any state)
```

---

### 3.5 Materials & Pricing API
```
GET    /api/materials
GET    /api/materials/{id}
POST   /api/materials
PATCH  /api/materials/{id}
GET    /api/materials/search
GET    /api/pricing/current
POST   /api/pricing/upload
GET    /api/pricing/history
Material Schema:
typescriptinterface Material {
  id: string;
  item_code: string;  // Internal or supplier code
  
  description: {
    short: string;
    full: string;
    specifications?: string;
  };
  
  category: {
    primary: 'lumber' | 'panels' | 'hardware' | 'roofing' | 'misc';
    subcategory?: string;
  };
  
  dimensions?: {
    nominal: string;  // "2x4"
    actual: string;   // "1.5x3.5"
    length?: number;
    unit: 'inches' | 'feet';
  };
  
  pricing: {
    base_price: number;
    unit: 'EA' | 'LF' | 'SF' | 'BF' | 'MBF';
    currency: 'USD';
    
    // Commodity pricing
    is_commodity: boolean;
    commodity_source?: 'Random Lengths' | 'Manual';
    last_updated: ISO8601;
    
    // Price history
    historical: [{
      effective_date: ISO8601;
      price: number;
      change_percentage: number;
    }];
  };
  
  suppliers: [{
    supplier_id: string;
    supplier_name: string;
    supplier_item_code: string;
    lead_time_days: number;
    minimum_order_quantity?: number;
    is_preferred: boolean;
  }];
  
  metadata: {
    created_at: ISO8601;
    updated_at: ISO8601;
    tags: string[];
  };
}
Pricing Update (Commodity):
httpPOST /api/pricing/upload
Content-Type: application/json

{
  "source": "Random Lengths",
  "report_date": "2025-11-14",
  "market": "Pacific Northwest",
  "items": [
    {
      "item_code": "KD-HF-2x4-8",
      "price_per_mbf": 450,
      "change_from_last_week": 15
    }
  ]
}

Response:
{
  "success": true,
  "data": {
    "items_updated": 47,
    "projects_affected": 12,
    "notifications_sent": 3
  }
}
```

---

### 3.6 Schedule & Activities API
```
GET    /api/projects/{projectId}/activities
POST   /api/projects/{projectId}/activities
GET    /api/activities/{id}
PATCH  /api/activities/{id}
DELETE /api/activities/{id}
GET    /api/activities/{id}/dependencies
POST   /api/activities/{id}/dependencies
Activity Schema:
typescriptinterface Activity {
  id: string;
  project_id: string;
  
  title: string;
  description?: string;
  type: 'milestone' | 'task' | 'delivery' | 'inspection';
  
  dates: {
    baseline_start: ISO8601;
    baseline_end: ISO8601;
    projected_start: ISO8601;
    projected_end: ISO8601;
    scheduled_start: ISO8601;
    scheduled_end: ISO8601;
    actual_start?: ISO8601;
    actual_end?: ISO8601;
  };
  
  status: 'planned' | 'in_progress' | 'complete' | 'delayed' | 'cancelled';
  
  progress: {
    percent_complete: number;  // 0-100
    updated_at: ISO8601;
  };
  
  dependencies: [{
    predecessor_id: string;
    type: 'FS' | 'SS' | 'FF' | 'SF';  // Finish-Start, Start-Start, etc.
    lag_days?: number;
  }];
  
  resources: {
    assigned_to?: string[];
    purchase_orders?: string[];
    documents?: string[];
  };
  
  custom_fields: {
    user_date_1?: ISO8601;
    user_date_2?: ISO8601;
    user_text_1?: string;
    user_number_1?: number;
  };
  
  permissions: {
    can_modify: boolean;
    can_delete: boolean;
  };
  
  metadata: {
    created_by: string;
    created_at: ISO8601;
    updated_at: ISO8601;
  };
}
```

**Dependency Types:**
```
FS (Finish-Start): Task B starts after Task A finishes
SS (Start-Start):  Task B starts when Task A starts
FF (Finish-Finish): Task B finishes when Task A finishes
SF (Start-Finish):  Task B finishes when Task A starts (rare)
```

---

### 3.7 Document Management API
```
POST   /api/documents/upload
GET    /api/documents
GET    /api/documents/{id}
DELETE /api/documents/{id}
POST   /api/documents/search
GET    /api/documents/{id}/download
POST   /api/documents/{id}/link
Document Schema:
typescriptinterface Document {
  id: string;
  filename: string;
  mime_type: string;
  size_bytes: number;
  
  storage: {
    provider: 'internal' | 'google_drive' | 's3';
    url: string;
    external_id?: string;  // Google Drive file ID, etc.
  };
  
  classification: {
    type: 'plan' | 'takeoff' | 'po' | 'invoice' | 'photo' | 'report' | 'misc';
    category?: string;
  };
  
  linked_to: {
    projects: string[];
    purchase_orders: string[];
    activities: string[];
  };
  
  metadata: {
    uploaded_by: string;
    uploaded_at: ISO8601;
    modified_at: ISO8601;
    tags: string[];
    
    // Extracted from filename if present
    parsed_data?: {
      project_name?: string;
      plan_name?: string;
      revision?: string;
      date?: string;
    };
  };
  
  access_control: {
    visibility: 'private' | 'project' | 'company' | 'public';
    allowed_users?: string[];
  };
}
Upload Example:
httpPOST /api/documents/upload
Content-Type: multipart/form-data

file: [binary data]
metadata: {
  "type": "plan",
  "project_id": "12345",
  "tags": ["floor_plan", "revision_3"]
}

Response:
{
  "success": true,
  "data": {
    "id": "doc_abc123",
    "url": "https://storage.mindflow.construction/...",
    "thumbnail_url": "https://storage.mindflow.construction/.../thumb.jpg"
  }
}
```

---

### 3.8 User & Permissions API
```
GET    /api/users
GET    /api/users/{id}
POST   /api/users
PATCH  /api/users/{id}
GET    /api/users/me
PATCH  /api/users/me/preferences
GET    /api/permissions
POST   /api/permissions/check
User Schema:
typescriptinterface User {
  id: string;
  email: string;
  name: {
    first: string;
    last: string;
    display: string;
  };
  
  role: 'admin' | 'project_manager' | 'estimator' | 'superintendent' | 'viewer';
  
  company: {
    id: string;
    name: string;
    division?: string;
  };
  
  permissions: {
    projects: {
      create: boolean;
      read: boolean;
      update: boolean;
      delete: boolean;
    };
    purchase_orders: {
      create: boolean;
      approve: boolean;
      submit: boolean;
    };
    // ... other permission sets
  };
  
  preferences: {
    timezone: string;
    date_format: 'MM/DD/YYYY' | 'DD/MM/YYYY' | 'YYYY-MM-DD';
    measurement_system: 'imperial' | 'metric';
    currency: 'USD' | 'JPY';
    
    grid_settings: {
      [gridId: string]: {
        columns: string[];
        sort: { field: string; direction: 'asc' | 'desc' };
        page_size: number;
      };
    };
  };
  
  metadata: {
    created_at: ISO8601;
    last_login: ISO8601;
    status: 'active' | 'inactive' | 'suspended';
  };
}
```

---

### 3.9 Webhook API
```
POST   /api/webhooks
GET    /api/webhooks
GET    /api/webhooks/{id}
PATCH  /api/webhooks/{id}
DELETE /api/webhooks/{id}
GET    /api/webhooks/{id}/deliveries
POST   /api/webhooks/{id}/test
Webhook Configuration:
typescriptinterface Webhook {
  id: string;
  name: string;
  url: string;
  
  events: [
    'project.created',
    'project.updated',
    'takeoff.completed',
    'purchase_order.submitted',
    'purchase_order.confirmed',
    'pricing.significant_change',
    'activity.completed',
    'document.uploaded'
  ];
  
  filters?: {
    project_ids?: string[];
    builder_ids?: string[];
    status?: string[];
  };
  
  security: {
    secret: string;  // For HMAC signature verification
    headers?: Record<string, string>;
  };
  
  config: {
    enabled: boolean;
    retry_on_failure: boolean;
    max_retries: number;
    timeout_seconds: number;
  };
  
  metadata: {
    created_at: ISO8601;
    last_triggered: ISO8601;
    delivery_count: number;
    failure_count: number;
  };
}
Webhook Payload Format:
javascript{
  event: 'purchase_order.confirmed',
  timestamp: '2025-11-14T10:30:00Z',
  data: {
    id: 'po_123',
    po_number: 'PO-2025-001',
    project_id: 'proj_456',
    status: 'confirmed',
    // ... full PO object
  },
  metadata: {
    webhook_id: 'webhook_789',
    delivery_id: 'delivery_abc123'
  }
}

// HTTP Headers
X-MindFlow-Event: purchase_order.confirmed
X-MindFlow-Signature: sha256=abc123...
X-MindFlow-Delivery: delivery_abc123
```

---

### 3.10 Integration Endpoints

**Google Workspace:**
```
POST   /api/integrations/google/authorize
GET    /api/integrations/google/gmail/search
POST   /api/integrations/google/gmail/link
GET    /api/integrations/google/calendar/events
POST   /api/integrations/google/calendar/create
GET    /api/integrations/google/drive/search
POST   /api/integrations/google/drive/upload
```

**PlanSwift:**
```
POST   /api/integrations/planswift/export
POST   /api/integrations/planswift/import
GET    /api/integrations/planswift/assemblies
```

**Random Lengths:**
```
POST   /api/integrations/random-lengths/upload-csv
GET    /api/integrations/random-lengths/current
GET    /api/integrations/random-lengths/historical
POST   /api/integrations/random-lengths/webhook  // For receiving updates

<a name="data-models"></a>
4. Data Models & Schemas
4.1 Core Entities
mermaiderDiagram
    BUILDER ||--o{ PROJECT : has
    PROJECT ||--o{ TAKEOFF : has
    PROJECT ||--o{ PURCHASE_ORDER : has
    PROJECT ||--o{ ACTIVITY : has
    PROJECT ||--o{ DOCUMENT : has
    TAKEOFF ||--o{ MATERIAL_LINE : contains
    PURCHASE_ORDER ||--o{ PO_LINE : contains
    MATERIAL ||--o{ MATERIAL_LINE : references
    MATERIAL ||--o{ PO_LINE : references
    MATERIAL ||--o{ PRICING_HISTORY : has
    SUPPLIER ||--o{ PURCHASE_ORDER : fulfills
    ACTIVITY ||--o{ ACTIVITY_DEPENDENCY : has
    USER ||--o{ PROJECT : manages
4.2 Status Enumerations
typescript// Project Status Lifecycle
enum ProjectStatus {
  PLANNING = 'planning',
  ESTIMATING = 'estimating',
  APPROVED = 'approved',
  IN_PROGRESS = 'in_progress',
  COMPLETE = 'complete',
  ON_HOLD = 'on_hold',
  CANCELLED = 'cancelled'
}

// Purchase Order Status Lifecycle
enum POStatus {
  DRAFT = 'draft',
  SUBMITTED = 'submitted',
  CONFIRMED = 'confirmed',
  PARTIALLY_RECEIVED = 'partially_received',
  RECEIVED = 'received',
  CANCELLED = 'cancelled'
}

// Activity Status
enum ActivityStatus {
  PLANNED = 'planned',
  IN_PROGRESS = 'in_progress',
  COMPLETE = 'complete',
  DELAYED = 'delayed',
  CANCELLED = 'cancelled'
}

// Takeoff Status
enum TakeoffStatus {
  DRAFT = 'draft',
  CALCULATING = 'calculating',
  COMPLETE = 'complete',
  APPROVED = 'approved',
  REJECTED = 'rejected'
}
4.3 Validation Rules
typescript// Date Validation
const dateRules = {
  // All dates must be ISO 8601 with timezone
  format: /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}[+-]\d{2}:\d{2}$/,
  
  // Start must be before end
  startBeforeEnd: (start, end) => new Date(start) < new Date(end),
  
  // No dates in past for new projects (configurable)
  noBackdating: (date) => new Date(date) >= new Date()
};

// Quantity Validation
const quantityRules = {
  positive: (qty) => qty > 0,
  maxDecimals: (qty, decimals = 2) => {
    const str = qty.toString();
    return !str.includes('.') || str.split('.')[1].length <= decimals;
  }
};

// PO Number Format
const poNumberRules = {
  format: /^PO-\d{4}-\d{3,6}$/,  // PO-2025-001234
  unique: true
};
4.4 Calculated Fields
typescript// These should be computed, never stored
interface CalculatedFields {
  // Purchase Order
  po_subtotal: sum(items.total_price);
  po_total: subtotal + tax + shipping;
  
  // Takeoff
  takeoff_total_cost: sum(materials.total_cost);
  takeoff_total_estimate: materials_cost + labor_estimate;
  
  // Project
  project_budget_remaining: budget - sum(purchase_orders.total);
  project_percent_complete: sum(activities.percent_complete) / count(activities);
  
  // Material
  material_current_price: most_recent(pricing_history.price);
  material_price_trend: compare(current_price, price_30_days_ago);
}

<a name="migration-strategy"></a>
5. Migration & Bridge Strategy
5.1 Phase 1: API Foundation (Months 1-2)
Goal: Build core REST API without breaking existing systems
Steps:

Deploy API Gateway

Authentication/Authorization layer
Rate limiting
Request/response logging
API versioning support


Create Core Endpoints

Projects CRUD
Takeoffs CRUD
Purchase Orders CRUD
Materials/Pricing


Build Bridge Adapters

typescript   class LegacyBATAdapter {
     // Converts old Excel format to new API
     async convertExcelToAPI(file: File): Promise<Takeoff> {
       const data = await this.parseExcel(file);
       return {
         measurements: this.extractMeasurements(data),
         materials: this.extractMaterials(data),
         // ... map all fields
       };
     }
     
     async syncToAPI(takeoff: Takeoff): Promise<void> {
       await fetch('/api/takeoffs', {
         method: 'POST',
         body: JSON.stringify(takeoff)
       });
     }
   }

5.2 Phase 2: Client Migration (Months 3-4)
Goal: Migrate Richmond American (61 plans) as pilot
Migration Flow:
javascript// Step 1: Bulk import existing plans
POST /api/migration/richmond-american/plans/bulk-import
{
  plans: [
    { legacy_id: 'BA-001', name: 'Plan A', files: [...] }
  ]
}

// Step 2: Convert BAT takeoffs
POST /api/migration/richmond-american/takeoffs/convert
{
  source: 'excel',
  files: ['BAT_Plan_A_v2.xlsx', ...],
  target_format: 'ReadyFrame_v4'
}

// Step 3: Verify data integrity
GET /api/migration/richmond-american/validation-report

// Step 4: Cutover
POST /api/migration/richmond-american/activate
{
  deactivate_legacy: true,
  redirect_users: true
}
Rollback Plan:
javascript// If issues arise, revert to legacy
POST /api/migration/richmond-american/rollback
{
  restore_point: '2025-11-14T10:00:00Z'
}

5.3 Phase 3: External Integrations (Months 5-6)
Priority Order:

Google Workspace (highest impact)

Email parsing for PO numbers
Calendar sync for deliveries
Drive document storage


Random Lengths (pricing critical)

Automated CSV import
Webhook for price changes
Historical data backfill


PlanSwift (estimator workflow)

Bidirectional sync
Assembly library sharing



Integration Testing Matrix:
typescriptinterface IntegrationTest {
  service: 'google' | 'random_lengths' | 'planswift';
  scenarios: [
    {
      name: 'Create calendar event from PO',
      steps: [
        'Create PO via API',
        'Verify calendar event created',
        'Check event details match PO'
      ],
      expected_time_ms: 2000
    }
  ];
}

5.4 Data Migration Scripts
Takeoff Migration:
typescriptclass TakeoffMigrationService {
  async migrateFromExcel(filePath: string): Promise<MigrationResult> {
    const workbook = await this.loadExcel(filePath);
    
    // Extract data from known Excel structure
    const measurements = this.extractMeasurements(workbook);
    const materials = this.extractMaterials(workbook);
    
    // Transform to API format
    const takeoff: Takeoff = {
      id: generateId(),
      measurements: this.transformMeasurements(measurements),
      materials: this.transformMaterials(materials),
      status: 'complete',
      metadata: {
        migrated_from: 'excel',
        original_file: filePath,
        migration_date: new Date().toISOString()
      }
    };
    
    // Validate before insert
    const validation = await this.validate(takeoff);
    if (!validation.isValid) {
      return { success: false, errors: validation.errors };
    }
    
    // Insert via API
    await this.api.post('/api/takeoffs', takeoff);
    
    return { 
      success: true, 
      takeoff_id: takeoff.id,
      materials_count: materials.length 
    };
  }
  
  async batchMigrate(files: string[]): Promise<BatchMigrationResult> {
    const results = await Promise.all(
      files.map(file => this.migrateFromExcel(file))
    );
    
    return {
      total: files.length,
      succeeded: results.filter(r => r.success).length,
      failed: results.filter(r => !r.success).length,
      details: results
    };
  }
}
Purchase Order Migration:
typescriptclass POMigrationService {
  async migrateFromLegacyDB(legacyPOs: LegacyPO[]): Promise<MigrationResult> {
    const transformed = legacyPOs.map(po => ({
      // Map legacy fields to new schema
      po_number: po.PoNumber,
      status: this.mapStatus(po.StatusCode),
      supplier: {
        id: po.SupplierId,
        name: po.SupplierName
      },
      items: po.Items.map(item => ({
        item_code: item.ItemCode,
        quantity: item.Quantity,
        unit_price: item.UnitPrice
      })),
      dates: {
        // Handle timezone conversion
        created: this.toISO8601(po.CreatedDate),
        requested_delivery: this.toISO8601(po.RequiredDate)
      }
    }));
    
    // Batch insert
    await this.api.post('/api/purchase-orders/batch', {
      orders: transformed
    });
    
    return { migrated: transformed.length };
  }
}

<a name="roadmap"></a>
6. Implementation Roadmap
Month 1: Foundation
Week 1-2: Infrastructure

 Set up API gateway (AWS API Gateway / Azure APIM / Kong)
 Configure authentication (OAuth 2.0 + JWT)
 Set up database (PostgreSQL with TimescaleDB for time-series pricing)
 Deploy monitoring (Datadog / New Relic)

Week 3-4: Core APIs

 Projects API (CRUD + search)
 Users & Permissions API
 Document upload/download API

Deliverable: Working API accepting project creation requests

Month 2: Business Logic
Week 1-2: Takeoff System

 Takeoff API with calculation engine
 ReadyFrame v4 algorithm implementation
 Material library seeding

Week 3-4: Purchase Orders

 PO API with workflow
 Status transition validation
 Email notifications on status changes

Deliverable: Can create takeoff ‚Üí generate materials ‚Üí create PO

Month 3: Richmond American Migration
Week 1: Data Extraction

 Export all 61 building plans
 Extract existing BAT takeoffs
 Map custom fields to new schema

Week 2: Transformation

 Convert Excel ‚Üí API format
 Validate data integrity
 Create user accounts

Week 3: Testing

 Parallel run (old + new systems)
 User acceptance testing
 Performance benchmarking

Week 4: Cutover

 Production migration
 Monitor for issues
 Support escalation

Deliverable: Richmond American fully migrated, 10-15min ‚Üí 1-2min processing time achieved

Month 4: Holt Homes + Pricing
Week 1-2: Holt Migration

 Import existing projects
 Configure custom CSV fields
 Set up advanced material management

Week 3-4: Random Lengths Integration

 CSV upload automation
 Pricing webhook implementation
 Price change notifications

Deliverable: Automated commodity pricing updates

Month 5: Google Workspace
Week 1: Gmail Integration

 OAuth setup
 Email search API
 PO number parsing

Week 2: Calendar Integration

 Event creation from activities
 Delivery scheduling sync
 Free/busy checking

Week 3: Drive Integration

 Document upload
 Automatic project folder creation
 Filename parsing for metadata

Week 4: Testing

 End-to-end workflow tests
 Performance optimization
 User training materials

Deliverable: Full Google Workspace integration live

Month 6: Sekisui & Expansion
Week 1-2: Sekisui Setup

 Multi-tenancy configuration
 Division isolation
 Approval workflow engine

Week 3: PlanSwift Integration

 Export to PlanSwift format
 Import from PlanSwift
 Assembly library sync

Week 4: Optimization & Documentation

 API performance tuning
 Complete API documentation
 Developer portal launch

Deliverable: Platform ready for additional builders

7. Success Metrics
Performance Targets
javascriptconst successMetrics = {
  // Processing time reduction
  takeoff_time: {
    baseline: '10-15 minutes',
    target: '1-2 minutes',
    improvement: '80-90%'
  },
  
  // API performance
  api_response_time: {
    p50: '< 200ms',
    p95: '< 500ms',
    p99: '< 1000ms'
  },
  
  // System reliability
  uptime: '99.9%',  // ~8.76 hours downtime/year
  
  // Data accuracy
  takeoff_accuracy: '> 98%',  // vs. manual verification
  pricing_sync_lag: '< 1 hour',  // From Random Lengths update
  
  // User satisfaction
  processing_errors: '< 1%',
  user_adoption: '> 90% within 3 months'
};

8. Next Steps

Review this document with your technical team
Prioritize builders for migration order
Select technology stack (recommend: Node.js/TypeScript + PostgreSQL + AWS)
Hire/assign developers (need 2-3 full-stack + 1 DevOps)
Set up development environment
Begin Month 1 tasks


Appendix A: Technology Recommendations
Backend:

Language: TypeScript (type safety critical for construction data)
Framework: NestJS (built-in dependency injection, similar to .NET)
Database: PostgreSQL 15+ (JSON support, TimescaleDB for pricing history)
Cache: Redis (session management, rate limiting)
Queue: Bull/BullMQ (async processing for takeoff calculations)

Frontend:

Framework: React 18+ with TypeScript
UI Library: Material-UI v5 (you already have it) or Tailwind CSS
State Management: Zustand or React Query
Forms: React Hook Form + Zod validation

Infrastructure:

Cloud: AWS (API Gateway, Lambda, RDS, S3, CloudWatch)
CI/CD: GitHub Actions
Monitoring: Datadog or New Relic
Error Tracking: Sentry

API Documentation:

OpenAPI 3.1 specification
Swagger UI for interactive docs
Postman collections for testing


Appendix B: Security Considerations
typescript// Authentication flow
const authFlow = {
  user_login: 'OAuth 2.0 + PKCE',
  api_access: 'JWT tokens (15min expiry)',
  refresh: 'Refresh tokens (7 days)',
  service_to_service: 'API keys with IP whitelist',
  
  // Data encryption
  in_transit: 'TLS 1.3',
  at_rest: 'AES-256',
  
  // Access control
  rbac: 'Role-based permissions',
  data_isolation: 'Row-level security (builder_id)',
  
  // Audit
  logging: 'All API calls logged',
  retention: '90 days minimum'
};

End of Report
This comprehensive audit provides you with everything needed to build unified APIs for consolidating your 30+ construction tools into the MindFlow platform. The next step is technical architecture design and selecting your development team.