====================================================================
RF TAKEOFF DATABASE SYSTEM - VBA CODE
Version 4.0
====================================================================

This file contains all VBA code needed for the UserForm-driven
takeoff system. Copy and paste into VBA Editor modules.

====================================================================
MODULE 1: Main Module (modMain)
====================================================================

Option Explicit

' Global variable for current project
Public g_CurrentProjectID As String
Public g_CurrentProjectName As String

' Initialize the system
Public Sub InitializeSystem()
    ' Check if Database sheet exists
    Dim ws As Worksheet
    On Error Resume Next
    Set ws = ThisWorkbook.Sheets("Database")
    On Error GoTo 0
    
    If ws Is Nothing Then
        MsgBox "Database sheet not found. Please check workbook structure.", vbCritical
        Exit Sub
    End If
    
    ' Load the main form
    frmMain.Show
End Sub

' Generate unique Entry ID
Public Function GenerateEntryID(sheetName As String) As String
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim prefix As String
    
    Set ws = ThisWorkbook.Sheets(sheetName)
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    
    ' Determine prefix based on sheet
    Select Case sheetName
        Case "WallData"
            prefix = "WALL"
        Case "RoofData"
            prefix = "ROOF"
        Case "PostBeamData"
            prefix = "PB"
        Case "FloorSystemData"
            prefix = "FLR"
        Case "DeckFramingData"
            prefix = "DECK"
        Case "DeckSurfaceData"
            prefix = "SURF"
        Case Else
            prefix = "ENTRY"
    End Select
    
    GenerateEntryID = prefix & "-" & Format(lastRow, "0000")
End Function

' Generate unique Project ID
Public Function GenerateProjectID() As String
    Dim ws As Worksheet
    Dim lastRow As Long
    
    Set ws = ThisWorkbook.Sheets("Database")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row
    
    GenerateProjectID = "PROJ-" & Format(lastRow, "000")
End Function

' Validate numeric input
Public Function IsValidNumber(value As String, minVal As Double, maxVal As Double) As Boolean
    On Error GoTo ErrorHandler
    
    Dim numVal As Double
    numVal = CDbl(value)
    
    IsValidNumber = (numVal >= minVal And numVal <= maxVal)
    Exit Function
    
ErrorHandler:
    IsValidNumber = False
End Function

' Auto-select panel height based on wall height
Public Function GetPanelHeight(wallHeight As Double) As String
    If wallHeight <= 8 Then
        GetPanelHeight = "8"
    ElseIf wallHeight <= 9 Then
        GetPanelHeight = "9"
    ElseIf wallHeight <= 10 Then
        GetPanelHeight = "10"
    Else
        GetPanelHeight = "12"
    End If
End Function

' Calculate joist quantity based on spacing
Public Function CalculateJoistQty(spanLength As Double, spacing As String) As Long
    Select Case spacing
        Case "12"" O.C.", "12"
            CalculateJoistQty = Application.WorksheetFunction.RoundUp(spanLength + 1, 0)
        Case "16"" O.C.", "16"
            CalculateJoistQty = Application.WorksheetFunction.RoundUp(spanLength / 1.33 + 1, 0)
        Case "19.2"" O.C.", "19.2"
            CalculateJoistQty = Application.WorksheetFunction.RoundUp(spanLength / 1.6 + 1, 0)
        Case "24"" O.C.", "24"
            CalculateJoistQty = Application.WorksheetFunction.RoundUp(spanLength / 2 + 1, 0)
        Case Else
            CalculateJoistQty = 0
    End Select
End Function

' Get slope factor from pitch
Public Function GetSlopeFactor(pitch As String) As Double
    Select Case pitch
        Case "3/12": GetSlopeFactor = 1.031
        Case "4/12": GetSlopeFactor = 1.054
        Case "5/12": GetSlopeFactor = 1.083
        Case "6/12": GetSlopeFactor = 1.118
        Case "7/12": GetSlopeFactor = 1.158
        Case "8/12": GetSlopeFactor = 1.202
        Case "9/12": GetSlopeFactor = 1.25
        Case "10/12": GetSlopeFactor = 1.302
        Case "12/12": GetSlopeFactor = 1.414
        Case Else: GetSlopeFactor = 1
    End Select
End Function

====================================================================
MODULE 2: Validation Module (modValidation)
====================================================================

Option Explicit

' Validate project information
Public Function ValidateProjectInfo(ByRef errors As Collection) As Boolean
    Dim isValid As Boolean
    isValid = True
    Set errors = New Collection
    
    With frmMain
        ' Required fields
        If Trim(.txtProjectName.value) = "" Then
            errors.Add "Project name is required"
            isValid = False
        End If
        
        If Trim(.txtEstimator.value) = "" Then
            errors.Add "Estimator name is required"
            isValid = False
        End If
        
        If .cmbBuildingType.ListIndex = -1 Then
            errors.Add "Building type must be selected"
            isValid = False
        End If
        
        If .cmbStories.ListIndex = -1 Then
            errors.Add "Number of stories must be selected"
            isValid = False
        End If
    End With
    
    ValidateProjectInfo = isValid
End Function

' Validate wall entry
Public Function ValidateWallEntry(length As String, height As String, _
                                openingSF As String, ByRef errors As Collection) As Boolean
    Dim isValid As Boolean
    isValid = True
    Set errors = New Collection
    
    ' Validate length
    If Not IsValidNumber(length, 0.1, 1000) Then
        errors.Add "Length must be between 0.1 and 1000 feet"
        isValid = False
    End If
    
    ' Validate height
    If Not IsValidNumber(height, 0.1, 20) Then
        errors.Add "Height must be between 0.1 and 20 feet"
        isValid = False
    Else
        Dim h As Double
        h = CDbl(height)
        If h > 12 Then
            errors.Add "Warning: Wall height exceeds standard 12' panel. Review design."
        End If
    End If
    
    ' Validate opening SF
    If openingSF <> "" Then
        If Not IsValidNumber(openingSF, 0, 10000) Then
            errors.Add "Opening SF must be a valid number"
            isValid = False
        End If
    End If
    
    ValidateWallEntry = isValid
End Function

' Validate roof entry
Public Function ValidateRoofEntry(run As String, depth As String, _
                                pitch As String, ByRef errors As Collection) As Boolean
    Dim isValid As Boolean
    isValid = True
    Set errors = New Collection
    
    ' Validate run
    If Not IsValidNumber(run, 0.1, 500) Then
        errors.Add "Run must be between 0.1 and 500 feet"
        isValid = False
    End If
    
    ' Validate depth
    If Not IsValidNumber(depth, 0.1, 500) Then
        errors.Add "Depth must be between 0.1 and 500 feet"
        isValid = False
    End If
    
    ' Validate pitch format
    If Not pitch Like "#/##" And Not pitch Like "##/##" Then
        errors.Add "Pitch must be in format X/12 (e.g., 6/12)"
        isValid = False
    End If
    
    ValidateRoofEntry = isValid
End Function

' Validate deck hardware is Z-MAX
Public Function ValidateDeckHardware(hardwareType As String, ByRef errors As Collection) As Boolean
    Dim isValid As Boolean
    isValid = True
    Set errors = New Collection
    
    If InStr(1, UCase(hardwareType), "Z-MAX") = 0 And _
       InStr(1, UCase(hardwareType), "ZMAX") = 0 Then
        errors.Add "WARNING: All deck hardware must be Z-MAX corrosion resistant!"
        isValid = False
    End If
    
    ValidateDeckHardware = isValid
End Function

' Validate floor blocking
Public Function ValidateFloorBlocking(blockingLF As String, ByRef errors As Collection) As Boolean
    Dim isValid As Boolean
    isValid = True
    Set errors = New Collection
    
    If Trim(blockingLF) = "" Or CDbl(blockingLF) = 0 Then
        errors.Add "CRITICAL: Blocking required at ALL beams and walls! Do not forget!"
        isValid = False
    End If
    
    ValidateFloorBlocking = isValid
End Function

====================================================================
MODULE 3: Database Module (modDatabase)
====================================================================

Option Explicit

' Save project to database
Public Function SaveProject(projData As ProjectData) As String
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim projectID As String
    
    Set ws = ThisWorkbook.Sheets("Database")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    projectID = GenerateProjectID()
    
    With ws
        .Cells(lastRow, 1) = projectID
        .Cells(lastRow, 2) = projData.ProjectName
        .Cells(lastRow, 3) = projData.ProjectNumber
        .Cells(lastRow, 4) = projData.ClientName
        .Cells(lastRow, 5) = projData.Estimator
        .Cells(lastRow, 6) = Format(Date, "yyyy-mm-dd")
        .Cells(lastRow, 7) = projData.Address
        .Cells(lastRow, 8) = projData.City
        .Cells(lastRow, 9) = projData.State
        .Cells(lastRow, 10) = projData.Zip
        .Cells(lastRow, 11) = projData.BuildingType
        .Cells(lastRow, 12) = "Active"
        .Cells(lastRow, 13) = projData.Stories
        .Cells(lastRow, 14) = projData.HasDeck
        .Cells(lastRow, 15) = projData.TotalSF
        .Cells(lastRow, 16) = projData.Notes
    End With
    
    g_CurrentProjectID = projectID
    g_CurrentProjectName = projData.ProjectName
    
    SaveProject = projectID
End Function

' Save wall entry to database
Public Sub SaveWallEntry(wallData As WallData)
    Dim ws As Worksheet
    Dim lastRow As Long
    
    Set ws = ThisWorkbook.Sheets("WallData")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    With ws
        .Cells(lastRow, 1) = GenerateEntryID("WallData")
        .Cells(lastRow, 2) = g_CurrentProjectID
        .Cells(lastRow, 3) = wallData.FloorLevel
        .Cells(lastRow, 4) = wallData.PlanNumber
        .Cells(lastRow, 5) = wallData.Elevation
        .Cells(lastRow, 6) = wallData.WallID
        .Cells(lastRow, 7) = wallData.Length
        .Cells(lastRow, 8) = wallData.Height
        .Cells(lastRow, 9) = wallData.Length * wallData.Height ' Gross SF
        .Cells(lastRow, 10) = wallData.OpeningSF
        .Cells(lastRow, 11) = (wallData.Length * wallData.Height) - wallData.OpeningSF ' Net SF
        .Cells(lastRow, 12) = wallData.Corners
        .Cells(lastRow, 13) = wallData.HeaderLF
        .Cells(lastRow, 14) = GetPanelHeight(wallData.Height)
        .Cells(lastRow, 15) = "=K" & lastRow & "/" & _
            "(IF(N" & lastRow & "=8,32,IF(N" & lastRow & "=9,36,IF(N" & lastRow & "=10,40,48))))"
        .Cells(lastRow, 16) = Format(Date, "yyyy-mm-dd")
        .Cells(lastRow, 17) = "Yes"
    End With
End Sub

' Save roof entry to database
Public Sub SaveRoofEntry(roofData As RoofData)
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim slopeFactor As Double
    
    Set ws = ThisWorkbook.Sheets("RoofData")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    slopeFactor = GetSlopeFactor(roofData.Pitch)
    
    With ws
        .Cells(lastRow, 1) = GenerateEntryID("RoofData")
        .Cells(lastRow, 2) = g_CurrentProjectID
        .Cells(lastRow, 3) = roofData.PlanNumber
        .Cells(lastRow, 4) = roofData.Section
        .Cells(lastRow, 5) = roofData.Run
        .Cells(lastRow, 6) = roofData.Depth
        .Cells(lastRow, 7) = roofData.Pitch
        .Cells(lastRow, 8) = slopeFactor
        .Cells(lastRow, 9) = roofData.Run * roofData.Depth * slopeFactor ' Gross SF
        .Cells(lastRow, 10) = roofData.EaveOH
        .Cells(lastRow, 11) = roofData.RakeOH
        .Cells(lastRow, 12) = roofData.RidgeLF
        .Cells(lastRow, 13) = roofData.HipLF
        .Cells(lastRow, 14) = roofData.ValleyLF
        .Cells(lastRow, 15) = Format(Date, "yyyy-mm-dd")
        .Cells(lastRow, 16) = "Yes"
    End With
End Sub

' Save post/beam entry
Public Sub SavePostBeamEntry(pbData As PostBeamData)
    Dim ws As Worksheet
    Dim lastRow As Long
    
    Set ws = ThisWorkbook.Sheets("PostBeamData")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    With ws
        .Cells(lastRow, 1) = GenerateEntryID("PostBeamData")
        .Cells(lastRow, 2) = g_CurrentProjectID
        .Cells(lastRow, 3) = pbData.Location
        .Cells(lastRow, 4) = pbData.BeamID
        .Cells(lastRow, 5) = pbData.BeamType
        .Cells(lastRow, 6) = pbData.BeamSize
        .Cells(lastRow, 7) = pbData.BeamLength
        .Cells(lastRow, 8) = pbData.BeamQty
        .Cells(lastRow, 9) = pbData.BeamLength * pbData.BeamQty ' Total LF
        .Cells(lastRow, 10) = pbData.PostSize
        .Cells(lastRow, 11) = pbData.PostHeight
        .Cells(lastRow, 12) = pbData.PostQty
        .Cells(lastRow, 13) = pbData.PostQty ' Bearing plates = post qty
        .Cells(lastRow, 14) = pbData.BeamQty ' Hangers = beam qty
        .Cells(lastRow, 15) = Format(Date, "yyyy-mm-dd")
        .Cells(lastRow, 16) = "Yes"
    End With
End Sub

' Save floor system entry
Public Sub SaveFloorEntry(floorData As FloorSystemData)
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim joistQty As Long
    
    Set ws = ThisWorkbook.Sheets("FloorSystemData")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    joistQty = CalculateJoistQty(floorData.SpanLength, floorData.Spacing)
    
    With ws
        .Cells(lastRow, 1) = GenerateEntryID("FloorSystemData")
        .Cells(lastRow, 2) = g_CurrentProjectID
        .Cells(lastRow, 3) = floorData.FloorLevel
        .Cells(lastRow, 4) = floorData.AreaID
        .Cells(lastRow, 5) = floorData.JoistType
        .Cells(lastRow, 6) = floorData.JoistSize
        .Cells(lastRow, 7) = floorData.Spacing
        .Cells(lastRow, 8) = floorData.SpanLength
        .Cells(lastRow, 9) = floorData.SpanDepth
        .Cells(lastRow, 10) = floorData.SpanLength * floorData.SpanDepth ' Area SF
        .Cells(lastRow, 11) = floorData.BlockingLF
        .Cells(lastRow, 12) = joistQty
        .Cells(lastRow, 13) = floorData.SpanLength * floorData.SpanDepth ' Sheathing SF
        .Cells(lastRow, 14) = Application.WorksheetFunction.RoundUp( _
            (floorData.SpanLength * floorData.SpanDepth) / 350, 0) ' Glue tubes
        .Cells(lastRow, 15) = joistQty * 2 ' Hangers estimate
        .Cells(lastRow, 16) = Format(Date, "yyyy-mm-dd")
        .Cells(lastRow, 17) = "Yes"
    End With
End Sub

' Save deck framing entry
Public Sub SaveDeckFramingEntry(deckData As DeckFramingData)
    Dim ws As Worksheet
    Dim lastRow As Long
    Dim joistQty As Long
    
    Set ws = ThisWorkbook.Sheets("DeckFramingData")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    joistQty = CalculateJoistQty(deckData.AreaLength, deckData.JoistSpacing)
    
    With ws
        .Cells(lastRow, 1) = GenerateEntryID("DeckFramingData")
        .Cells(lastRow, 2) = g_CurrentProjectID
        .Cells(lastRow, 3) = deckData.DeckArea
        .Cells(lastRow, 4) = deckData.PostSize
        .Cells(lastRow, 5) = deckData.PostQty
        .Cells(lastRow, 6) = deckData.BeamSize
        .Cells(lastRow, 7) = deckData.BeamLF
        .Cells(lastRow, 8) = deckData.JoistSize
        .Cells(lastRow, 9) = deckData.JoistSpacing
        .Cells(lastRow, 10) = deckData.AreaLength
        .Cells(lastRow, 11) = deckData.AreaDepth
        .Cells(lastRow, 12) = joistQty
        .Cells(lastRow, 13) = deckData.JoistSize
        .Cells(lastRow, 14) = deckData.AreaLength ' Ledger LF
        .Cells(lastRow, 15) = deckData.HardwareType
        .Cells(lastRow, 16) = Format(Date, "yyyy-mm-dd")
        .Cells(lastRow, 17) = "Yes"
    End With
End Sub

' Save deck surface entry
Public Sub SaveDeckSurfaceEntry(surfaceData As DeckSurfaceData)
    Dim ws As Worksheet
    Dim lastRow As Long
    
    Set ws = ThisWorkbook.Sheets("DeckSurfaceData")
    lastRow = ws.Cells(ws.Rows.Count, 1).End(xlUp).Row + 1
    
    With ws
        .Cells(lastRow, 1) = GenerateEntryID("DeckSurfaceData")
        .Cells(lastRow, 2) = g_CurrentProjectID
        .Cells(lastRow, 3) = surfaceData.AreaID
        .Cells(lastRow, 4) = surfaceData.DeckingType
        .Cells(lastRow, 5) = surfaceData.AreaSF
        .Cells(lastRow, 6) = surfaceData.BoardLength
        .Cells(lastRow, 7) = Application.WorksheetFunction.RoundUp( _
            surfaceData.AreaSF / 6, 0) ' Board qty
        .Cells(lastRow, 8) = surfaceData.FasciaLF
        .Cells(lastRow, 9) = IIf(InStr(1, surfaceData.DeckingType, "Composite") > 0, _
            surfaceData.AreaSF / 2, 0) ' Blocking for composite
        .Cells(lastRow, 10) = Application.WorksheetFunction.RoundUp( _
            surfaceData.AreaSF / 100, 0) ' Screws lbs
        .Cells(lastRow, 11) = surfaceData.RailLF
        .Cells(lastRow, 12) = surfaceData.PostQty
        .Cells(lastRow, 13) = surfaceData.RailLF * 40 ' Balusters
        .Cells(lastRow, 14) = Format(Date, "yyyy-mm-dd")
        .Cells(lastRow, 15) = "Yes"
    End With
End Sub

====================================================================
MODULE 4: Type Definitions (modTypes)
====================================================================

Option Explicit

' Project data structure
Public Type ProjectData
    ProjectName As String
    ProjectNumber As String
    ClientName As String
    Estimator As String
    Address As String
    City As String
    State As String
    Zip As String
    BuildingType As String
    Stories As Integer
    HasDeck As String
    TotalSF As Double
    Notes As String
End Type

' Wall data structure
Public Type WallData
    FloorLevel As String
    PlanNumber As String
    Elevation As String
    WallID As String
    Length As Double
    Height As Double
    OpeningSF As Double
    Corners As Integer
    HeaderLF As Double
End Type

' Roof data structure
Public Type RoofData
    PlanNumber As String
    Section As String
    Run As Double
    Depth As Double
    Pitch As String
    EaveOH As Double
    RakeOH As Double
    RidgeLF As Double
    HipLF As Double
    ValleyLF As Double
End Type

' Post/Beam data structure
Public Type PostBeamData
    Location As String
    BeamID As String
    BeamType As String
    BeamSize As String
    BeamLength As Double
    BeamQty As Integer
    PostSize As String
    PostHeight As Double
    PostQty As Integer
End Type

' Floor system data structure
Public Type FloorSystemData
    FloorLevel As String
    AreaID As String
    JoistType As String
    JoistSize As String
    Spacing As String
    SpanLength As Double
    SpanDepth As Double
    BlockingLF As Double
End Type

' Deck framing data structure
Public Type DeckFramingData
    DeckArea As String
    PostSize As String
    PostQty As Integer
    BeamSize As String
    BeamLF As Double
    JoistSize As String
    JoistSpacing As String
    AreaLength As Double
    AreaDepth As Double
    HardwareType As String
End Type

' Deck surface data structure
Public Type DeckSurfaceData
    AreaID As String
    DeckingType As String
    AreaSF As Double
    BoardLength As Double
    FasciaLF As Double
    RailLF As Double
    PostQty As Integer
End Type

====================================================================
USERFORM: frmMain (Main Data Entry Form)
====================================================================

' Form Layout:
' - MultiPage control with 7 tabs
' - Tab 0: Project Info
' - Tab 1: Post & Beam
' - Tab 2: Floor Systems
' - Tab 3: Walls
' - Tab 4: Roof
' - Tab 5: Deck Framing
' - Tab 6: Deck Surface

' Controls for Tab 0 (Project Info):
txtProjectName (TextBox)
txtProjectNumber (TextBox)
txtClientName (TextBox)
txtEstimator (TextBox)
txtAddress (TextBox)
txtCity (TextBox)
txtState (TextBox)
txtZip (TextBox)
cmbBuildingType (ComboBox): Residential, Commercial, Multi-Family, Industrial
cmbStories (ComboBox): 1, 2, 3, 4
cmbHasDeck (ComboBox): Yes, No
txtTotalSF (TextBox)
txtNotes (TextBox - multiline)
btnSaveProject (CommandButton)
lblChecklistProject (Label - shows checklist)

' Controls for Tab 3 (Walls):
cmbFloorLevel (ComboBox): Basement, 1st, 2nd, 3rd, 4th
txtPlanNumber (TextBox)
cmbElevation (ComboBox): N, S, E, W, NE, NW, SE, SW
txtWallID (TextBox)
txtLength (TextBox)
txtHeight (TextBox)
txtOpeningSF (TextBox)
txtCorners (TextBox)
txtHeaderLF (TextBox)
lblPanelHeight (Label - auto-calculated)
lblPanelQty (Label - auto-calculated)
btnAddWall (CommandButton)
lstWalls (ListBox - shows entered walls)
lblChecklistWall (Label - shows checklist)

' Similar controls for other tabs...

====================================================================
VBA CODE FOR USERFORM
====================================================================

Option Explicit

Private Sub UserForm_Initialize()
    ' Initialize Project tab
    With cmbBuildingType
        .AddItem "Residential"
        .AddItem "Commercial"
        .AddItem "Multi-Family"
        .AddItem "Industrial"
    End With
    
    With cmbStories
        .AddItem "1"
        .AddItem "2"
        .AddItem "3"
        .AddItem "4"
    End With
    
    With cmbHasDeck
        .AddItem "Yes"
        .AddItem "No"
    End With
    
    ' Initialize Wall tab
    With cmbFloorLevel
        .AddItem "Basement"
        .AddItem "1st"
        .AddItem "2nd"
        .AddItem "3rd"
        .AddItem "4th"
    End With
    
    With cmbElevation
        .AddItem "N"
        .AddItem "S"
        .AddItem "E"
        .AddItem "W"
        .AddItem "NE"
        .AddItem "NW"
        .AddItem "SE"
        .AddItem "SW"
    End With
    
    ' Display checklists
    Call DisplayProjectChecklist
    Call DisplayWallChecklist
End Sub

Private Sub btnSaveProject_Click()
    Dim errors As Collection
    Dim projData As ProjectData
    Dim projectID As String
    
    ' Validate inputs
    If Not ValidateProjectInfo(errors) Then
        Dim msg As String
        msg = "Please correct the following errors:" & vbCrLf & vbCrLf
        Dim err As Variant
        For Each err In errors
            msg = msg & "• " & err & vbCrLf
        Next
        MsgBox msg, vbExclamation, "Validation Errors"
        Exit Sub
    End If
    
    ' Populate project data
    With projData
        .ProjectName = Me.txtProjectName.value
        .ProjectNumber = Me.txtProjectNumber.value
        .ClientName = Me.txtClientName.value
        .Estimator = Me.txtEstimator.value
        .Address = Me.txtAddress.value
        .City = Me.txtCity.value
        .State = Me.txtState.value
        .Zip = Me.txtZip.value
        .BuildingType = Me.cmbBuildingType.value
        .Stories = CInt(Me.cmbStories.value)
        .HasDeck = Me.cmbHasDeck.value
        .TotalSF = CDbl(Me.txtTotalSF.value)
        .Notes = Me.txtNotes.value
    End With
    
    ' Save to database
    projectID = SaveProject(projData)
    
    MsgBox "Project saved successfully!" & vbCrLf & vbCrLf & _
           "Project ID: " & projectID & vbCrLf & _
           "You can now proceed with takeoff data entry.", _
           vbInformation, "Success"
    
    ' Enable other tabs
    Me.MultiPage1.Pages(1).Enabled = True
    Me.MultiPage1.Pages(2).Enabled = True
    Me.MultiPage1.Pages(3).Enabled = True
    Me.MultiPage1.Pages(4).Enabled = True
    Me.MultiPage1.Pages(5).Enabled = True
    Me.MultiPage1.Pages(6).Enabled = True
End Sub

Private Sub txtHeight_Change()
    ' Auto-calculate and display panel height
    If IsNumeric(Me.txtHeight.value) Then
        Dim height As Double
        height = CDbl(Me.txtHeight.value)
        Me.lblPanelHeight.Caption = GetPanelHeight(height) & " ft"
        
        ' Calculate panel quantity if we have net SF
        If IsNumeric(Me.txtLength.value) Then
            Dim length As Double
            Dim openingSF As Double
            Dim netSF As Double
            Dim panelSF As Double
            
            length = CDbl(Me.txtLength.value)
            openingSF = IIf(IsNumeric(Me.txtOpeningSF.value), CDbl(Me.txtOpeningSF.value), 0)
            netSF = (length * height) - openingSF
            
            Select Case GetPanelHeight(height)
                Case "8": panelSF = 32
                Case "9": panelSF = 36
                Case "10": panelSF = 40
                Case "12": panelSF = 48
            End Select
            
            Me.lblPanelQty.Caption = Format(netSF / panelSF, "0.0") & " panels"
        End If
    End If
End Sub

Private Sub btnAddWall_Click()
    Dim errors As Collection
    Dim wallData As WallData
    
    ' Validate wall entry
    If Not ValidateWallEntry(Me.txtLength.value, Me.txtHeight.value, _
                            Me.txtOpeningSF.value, errors) Then
        Dim msg As String
        msg = "Please correct the following errors:" & vbCrLf & vbCrLf
        Dim err As Variant
        For Each err In errors
            msg = msg & "• " & err & vbCrLf
        Next
        MsgBox msg, vbExclamation, "Validation Errors"
        Exit Sub
    End If
    
    ' Populate wall data
    With wallData
        .FloorLevel = Me.cmbFloorLevel.value
        .PlanNumber = Me.txtPlanNumber.value
        .Elevation = Me.cmbElevation.value
        .WallID = Me.txtWallID.value
        .Length = CDbl(Me.txtLength.value)
        .Height = CDbl(Me.txtHeight.value)
        .OpeningSF = IIf(IsNumeric(Me.txtOpeningSF.value), CDbl(Me.txtOpeningSF.value), 0)
        .Corners = IIf(IsNumeric(Me.txtCorners.value), CInt(Me.txtCorners.value), 0)
        .HeaderLF = IIf(IsNumeric(Me.txtHeaderLF.value), CDbl(Me.txtHeaderLF.value), 0)
    End With
    
    ' Save to database
    Call SaveWallEntry(wallData)
    
    ' Add to listbox
    Me.lstWalls.AddItem wallData.FloorLevel & " - " & wallData.WallID & _
                        " (" & wallData.Length & "' × " & wallData.Height & "')"
    
    ' Clear form
    Call ClearWallForm
    
    MsgBox "Wall entry saved successfully!", vbInformation
End Sub

Private Sub ClearWallForm()
    Me.txtPlanNumber.value = ""
    Me.cmbElevation.ListIndex = -1
    Me.txtWallID.value = ""
    Me.txtLength.value = ""
    Me.txtHeight.value = ""
    Me.txtOpeningSF.value = ""
    Me.txtCorners.value = ""
    Me.txtHeaderLF.value = ""
    Me.lblPanelHeight.Caption = ""
    Me.lblPanelQty.Caption = ""
End Sub

Private Sub DisplayProjectChecklist()
    Dim checklist As String
    checklist = "PROJECT SETUP CHECKLIST:" & vbCrLf & vbCrLf
    checklist = checklist & "☐ Project name entered" & vbCrLf
    checklist = checklist & "☐ Project number assigned" & vbCrLf
    checklist = checklist & "☐ Client information complete" & vbCrLf
    checklist = checklist & "☐ Estimator name recorded" & vbCrLf
    checklist = checklist & "☐ Building address entered" & vbCrLf
    checklist = checklist & "☐ Building type selected" & vbCrLf
    checklist = checklist & "☐ Number of stories confirmed" & vbCrLf
    checklist = checklist & "☐ Project scope defined" & vbCrLf
    
    Me.lblChecklistProject.Caption = checklist
End Sub

Private Sub DisplayWallChecklist()
    Dim checklist As String
    checklist = "WALL TAKEOFF CHECKLIST:" & vbCrLf & vbCrLf
    checklist = checklist & "☐ Floor level assigned" & vbCrLf
    checklist = checklist & "☐ Wall ID entered" & vbCrLf
    checklist = checklist & "☐ Length measured from plans" & vbCrLf
    checklist = checklist & "☐ Height from sections" & vbCrLf
    checklist = checklist & "☐ Openings calculated" & vbCrLf
    checklist = checklist & "☐ Corner count verified" & vbCrLf
    checklist = checklist & "☐ Headers measured" & vbCrLf
    checklist = checklist & "☐ Panel height auto-selected" & vbCrLf
    
    Me.lblChecklistWall.Caption = checklist
End Sub

====================================================================
INSTALLATION INSTRUCTIONS
====================================================================

1. Open RF_Takeoff_Database_System_v4.xlsx in Excel

2. Press ALT+F11 to open VBA Editor (Mac: Tools > Macro > Visual Basic)

3. Insert > Module (4 times to create 4 modules)
   - Module1: Copy modMain code
   - Module2: Copy modValidation code
   - Module3: Copy modDatabase code
   - Module4: Copy modTypes code

4. Insert > UserForm
   - Name it: frmMain
   - Design the form with:
     * MultiPage control (7 tabs)
     * TextBoxes, ComboBoxes, CommandButtons as listed above
     * Labels for displaying auto-calculated values
     * Labels for displaying checklists

5. Copy the UserForm VBA code into the form's code window

6. Save file as .xlsm (macro-enabled workbook)

7. Add a button on Dashboard sheet:
   - Developer tab > Insert > Button
   - Assign macro: InitializeSystem
   - Label: "Start New Takeoff"

====================================================================
USAGE WORKFLOW
====================================================================

1. Click "Start New Takeoff" button on Dashboard

2. Complete Project Info tab:
   - Fill all required fields
   - Review checklist
   - Click "Save Project"
   - Project ID will be generated

3. Move through tabs in order:
   - Post & Beam (if applicable)
   - Floor Systems
   - Walls (use floor-by-floor)
   - Roof
   - Deck Framing (if applicable)
   - Deck Surface (if applicable)

4. Each entry:
   - Fill in the form fields
   - Review auto-calculated values
   - Check the checklist
   - Click "Add Entry" button
   - Data is validated and saved to database

5. Generate material list:
   - Go to MaterialSummary sheet
   - Enter Project ID in cell B3
   - Material list auto-populates from database

6. Review and export:
   - All data stored in centralized database
   - Query by project for historical analysis
   - Export to proposals or purchase orders

====================================================================
NOTES
====================================================================

- All validation happens before data is saved
- Auto-calculations ensure accuracy
- Database structure allows for future analysis
- Checklists prevent missing critical items
- UserForm provides guided workflow
- Historical data retained for estimating future projects

====================================================================
